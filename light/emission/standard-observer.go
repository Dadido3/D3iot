// Copyright (c) 2021 David Vogel
//
// This software is released under the MIT License.
// https://opensource.org/licenses/MIT

package emission

// standardObserverCIE1931 contains the color matching functions x̅(λ), y̅(λ), z̅(λ).
type standardObserverCIE1931 struct {
	Start, StepSize float64                     // In nm.
	Table           []struct{ x, y, z float64 } // Table with values of the color matching functions.
}

// Integrate returns the integral of the multiplication of the color matching functions with Φeλ.
//
// Φeλ is the function of the spectral flux.
// Function f has to return the radiant flux Φe, not spectral flux.
// Φe is the integral of the spectral flux in the range [wavelength-bandwidth/2, wavelength+bandwidth/2).
//
// wavelength and bandwidth are measured in m.
func (s standardObserverCIE1931) Integrate(f func(wavelength, bandwidth float64) (Φe float64)) (x, y, z float64) {
	wavelength := s.Start
	for _, entry := range s.Table {
		wavelength += s.StepSize
		Φe := f(wavelength, s.StepSize)

		x += entry.x * Φe
		y += entry.y * Φe
		z += entry.z * Φe
	}
	return x, y, z
}

var StandardObserverCIE1931 = standardObserverCIE1931{
	Start:    360e-9,
	StepSize: 5e-9,
	Table: []struct{ x, y, z float64 }{
		{0.000_129_900_000, 0.000_003_917_000, 0.000_606_100_000},
		{0.000_232_100_000, 0.000_006_965_000, 0.001_086_000_000},
		{0.000_414_900_000, 0.000_012_390_000, 0.001_946_000_000},
		{0.000_741_600_000, 0.000_022_020_000, 0.003_486_000_000},
		{0.001_368_000_000, 0.000_039_000_000, 0.006_450_001_000},
		{0.002_236_000_000, 0.000_064_000_000, 0.010_549_990_000},
		{0.004_243_000_000, 0.000_120_000_000, 0.020_050_010_000},
		{0.007_650_000_000, 0.000_217_000_000, 0.036_210_000_000},
		{0.014_310_000_000, 0.000_396_000_000, 0.067_850_010_000},
		{0.023_190_000_000, 0.000_640_000_000, 0.110_200_000_000},
		{0.043_510_000_000, 0.001_210_000_000, 0.207_400_000_000},
		{0.077_630_000_000, 0.002_180_000_000, 0.371_300_000_000},
		{0.134_380_000_000, 0.004_000_000_000, 0.645_600_000_000},
		{0.214_770_000_000, 0.007_300_000_000, 1.039_050_100_000},
		{0.283_900_000_000, 0.011_600_000_000, 1.385_600_000_000},
		{0.328_500_000_000, 0.016_840_000_000, 1.622_960_000_000},
		{0.348_280_000_000, 0.023_000_000_000, 1.747_060_000_000},
		{0.348_060_000_000, 0.029_800_000_000, 1.782_600_000_000},
		{0.336_200_000_000, 0.038_000_000_000, 1.772_110_000_000},
		{0.318_700_000_000, 0.048_000_000_000, 1.744_100_000_000},
		{0.290_800_000_000, 0.060_000_000_000, 1.669_200_000_000},
		{0.251_100_000_000, 0.073_900_000_000, 1.528_100_000_000},
		{0.195_360_000_000, 0.090_980_000_000, 1.287_640_000_000},
		{0.142_100_000_000, 0.112_600_000_000, 1.041_900_000_000},
		{0.095_640_000_000, 0.139_020_000_000, 0.812_950_100_000},
		{0.057_950_010_000, 0.169_300_000_000, 0.616_200_000_000},
		{0.032_010_000_000, 0.208_020_000_000, 0.465_180_000_000},
		{0.014_700_000_000, 0.258_600_000_000, 0.353_300_000_000},
		{0.004_900_000_000, 0.323_000_000_000, 0.272_000_000_000},
		{0.002_400_000_000, 0.407_300_000_000, 0.212_300_000_000},
		{0.009_300_000_000, 0.503_000_000_000, 0.158_200_000_000},
		{0.029_100_000_000, 0.608_200_000_000, 0.111_700_000_000},
		{0.063_270_000_000, 0.710_000_000_000, 0.078_249_990_000},
		{0.109_600_000_000, 0.793_200_000_000, 0.057_250_010_000},
		{0.165_500_000_000, 0.862_000_000_000, 0.042_160_000_000},
		{0.225_749_900_000, 0.914_850_100_000, 0.029_840_000_000},
		{0.290_400_000_000, 0.954_000_000_000, 0.020_300_000_000},
		{0.359_700_000_000, 0.980_300_000_000, 0.013_400_000_000},
		{0.433_449_900_000, 0.994_950_100_000, 0.008_749_999_000},
		{0.512_050_100_000, 1.000_000_000_000, 0.005_749_999_000},
		{0.594_500_000_000, 0.995_000_000_000, 0.003_900_000_000},
		{0.678_400_000_000, 0.978_600_000_000, 0.002_749_999_000},
		{0.762_100_000_000, 0.952_000_000_000, 0.002_100_000_000},
		{0.842_500_000_000, 0.915_400_000_000, 0.001_800_000_000},
		{0.916_300_000_000, 0.870_000_000_000, 0.001_650_001_000},
		{0.978_600_000_000, 0.816_300_000_000, 0.001_400_000_000},
		{1.026_300_000_000, 0.757_000_000_000, 0.001_100_000_000},
		{1.056_700_000_000, 0.694_900_000_000, 0.001_000_000_000},
		{1.062_200_000_000, 0.631_000_000_000, 0.000_800_000_000},
		{1.045_600_000_000, 0.566_800_000_000, 0.000_600_000_000},
		{1.002_600_000_000, 0.503_000_000_000, 0.000_340_000_000},
		{0.938_400_000_000, 0.441_200_000_000, 0.000_240_000_000},
		{0.854_449_900_000, 0.381_000_000_000, 0.000_190_000_000},
		{0.751_400_000_000, 0.321_000_000_000, 0.000_100_000_000},
		{0.642_400_000_000, 0.265_000_000_000, 0.000_049_999_990},
		{0.541_900_000_000, 0.217_000_000_000, 0.000_030_000_000},
		{0.447_900_000_000, 0.175_000_000_000, 0.000_020_000_000},
		{0.360_800_000_000, 0.138_200_000_000, 0.000_010_000_000},
		{0.283_500_000_000, 0.107_000_000_000, 0.000_000_000_000},
		{0.218_700_000_000, 0.081_600_000_000, 0.000_000_000_000},
		{0.164_900_000_000, 0.061_000_000_000, 0.000_000_000_000},
		{0.121_200_000_000, 0.044_580_000_000, 0.000_000_000_000},
		{0.087_400_000_000, 0.032_000_000_000, 0.000_000_000_000},
		{0.063_600_000_000, 0.023_200_000_000, 0.000_000_000_000},
		{0.046_770_000_000, 0.017_000_000_000, 0.000_000_000_000},
		{0.032_900_000_000, 0.011_920_000_000, 0.000_000_000_000},
		{0.022_700_000_000, 0.008_210_000_000, 0.000_000_000_000},
		{0.015_840_000_000, 0.005_723_000_000, 0.000_000_000_000},
		{0.011_359_160_000, 0.004_102_000_000, 0.000_000_000_000},
		{0.008_110_916_000, 0.002_929_000_000, 0.000_000_000_000},
		{0.005_790_346_000, 0.002_091_000_000, 0.000_000_000_000},
		{0.004_109_457_000, 0.001_484_000_000, 0.000_000_000_000},
		{0.002_899_327_000, 0.001_047_000_000, 0.000_000_000_000},
		{0.002_049_190_000, 0.000_740_000_000, 0.000_000_000_000},
		{0.001_439_971_000, 0.000_520_000_000, 0.000_000_000_000},
		{0.000_999_949_300, 0.000_361_100_000, 0.000_000_000_000},
		{0.000_690_078_600, 0.000_249_200_000, 0.000_000_000_000},
		{0.000_476_021_300, 0.000_171_900_000, 0.000_000_000_000},
		{0.000_332_301_100, 0.000_120_000_000, 0.000_000_000_000},
		{0.000_234_826_100, 0.000_084_800_000, 0.000_000_000_000},
		{0.000_166_150_500, 0.000_060_000_000, 0.000_000_000_000},
		{0.000_117_413_000, 0.000_042_400_000, 0.000_000_000_000},
		{0.000_083_075_270, 0.000_030_000_000, 0.000_000_000_000},
		{0.000_058_706_520, 0.000_021_200_000, 0.000_000_000_000},
		{0.000_041_509_940, 0.000_014_990_000, 0.000_000_000_000},
		{0.000_029_353_260, 0.000_010_600_000, 0.000_000_000_000},
		{0.000_020_673_830, 0.000_007_465_700, 0.000_000_000_000},
		{0.000_014_559_770, 0.000_005_257_800, 0.000_000_000_000},
		{0.000_010_253_980, 0.000_003_702_900, 0.000_000_000_000},
		{0.000_007_221_456, 0.000_002_607_800, 0.000_000_000_000},
		{0.000_005_085_868, 0.000_001_836_600, 0.000_000_000_000},
		{0.000_003_581_652, 0.000_001_293_400, 0.000_000_000_000},
		{0.000_002_522_525, 0.000_000_910_930, 0.000_000_000_000},
		{0.000_001_776_509, 0.000_000_641_530, 0.000_000_000_000},
		{0.000_001_251_141, 0.000_000_451_810, 0.000_000_000_000},
	},
}
